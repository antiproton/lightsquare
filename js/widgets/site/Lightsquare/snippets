<div class="modal_overlay" on-click="hide_dialog" style="display: {{dialog ? '' : 'none'}}">
	<div class="restore_game_dialog" style="display: {{dialog === 'restoreGame' ? '' : 'none'}}" on-click="dialog_click">
		<div class="game_backup_list_container" id="game_backup_list">
			
		</div>
	</div>
	<div class="register_dialog" style="display: {{dialog === 'register' ? '' : 'none'}}" on-click="dialog_click">
		<div id="register_form" style="display: {{registered ? 'none' : ''}}">
			
		</div>
		{{#registered}}
			<h1>Welcome to Lightsquare, {{registeredUsername}}.</h1>
			<div class="register_success">
				<p>
					Your account has been created.
				</p>
				{{^registerAutoLoggedIn}}
					<p>
						(You can log in to your account after completing any games and logging
						out of any other accounts.)
					</p>
				{{/registerAutoLoggedIn}}
			</div>
			<div class="register_done">
				<input type="button" class="register_done" on-click="register_done" value="OK" autofocus>
			</div>
		{{/registered}}
	</div>
</div>

div.game_backup_list_container {
	display: flex;
	flex-grow: 1;
	position: relative;
	overflow-y: scroll;
	border: 1px solid #afafaf;
}

div.restore_game_dialog {
	display: flex;
	width: 65%;
	margin: 5% auto;
	border-bottom: 2px solid #303030;
	padding: .8em;
	box-shadow: 2px 2px 8px rgba(0, 0, 0, .3);
	background: white;
}

div.register_dialog {
	width: 35%;
	margin: 5% auto auto auto;
	border-bottom: 2px solid #303030;
	padding: .8em;
	box-shadow: 2px 2px 8px rgba(0, 0, 0, .3);
	background: white;
}

div.register_dialog h1 {
	font-size: 1.2em;
	font-weight: normal;
	margin: 0;
}

div.register_success {
	font-size: .8em;
	text-align: center;
	color: #2E7206;
	margin-top: .8em;
	border: 1px solid #D1D1D1;
	border-radius: 3px;
	padding: .5em;
}

input.register_done {
	color: #545454;
	text-shadow: 1px 1px 0 rgba(0, 0, 0, .1);
	border-color: #9B9B9B;
	padding: .3em 1em;
	background: #BFBFBF;
}

div.register_link {
	text-align: center;
	margin-top: .5em;
}


//////////widgets removed from HomePage


	var LoginForm = require("./_LoginForm/LoginForm");
	var GameBackupList = require("./_GameBackupList/GameBackupList");
	var CurrentGames = require("./_CurrentGames/CurrentGames");
	var RegisterForm = require("./_RegisterForm/RegisterForm");
	var RandomGames = require("RandomGames");
		new LoginForm(this._user, this._template.nodes.login_form);,
				registered: false
				tab: "home",
		
		var registerForm = new RegisterForm(this._user, this._template.nodes.register_form);
		
		registerForm.Registered.addHandler(function(data) {
			this._template.set("registered", true);
			this._template.set("registerAutoLoggedIn", data.loggedIn);
			this._template.set("registeredUsername", data.registeredUsername);
		}, this);
		
		this._gameBackupList = new GameBackupList(this._user, this._template.nodes.game_backup_list);
		
	
		
		this._currentGames = new CurrentGames(new RandomGames(this._server), this._template.nodes.current_games);
		
		this._currentGames.ClickGame.addHandler(function(id) {
			this._router.navigate("/game/" + id);
		}, this);
		
		this._template.on("select_tab", (function(event, tab) {
			this._template.set("tab", tab);
		}).bind(this));
		
		this._template.on("restore_game", (function() {
			this._showDialog("restoreGame");
			this._gameBackupList.refresh();
		}).bind(this));

		//////////////////////Play dialogs etc
		
		var lastClickTarget = null;
		
		this._template.on("hide_popups", (function() {
			this._hideMessage();
			
			if(lastClickTarget !== "controlPanel") {
				this._template.set("showControlPanel", false);
			}
			
			lastClickTarget = null;
		}).bind(this));
		
		this._template.on("hide_dialog", (function() {
			if(lastClickTarget !== "dialog") {
				this._template.set("showControlPanel", false);
			}
			
			lastClickTarget = null;
		}).bind(this));
		
		this._template.on("register_click", (function(event, target) {
			lastClickTarget = target;
		}).bind(this));
		
		this._template.on("dialog_click", (function(event, target) {
			lastClickTarget = "dialog";
		}).bind(this));
		
		this._template.on("logout", (function() {
			if(this._user.hasGamesInProgress()) {
				this._template.set("showLogoutConfirmation", true);
			}
			
			else {
				this._user.logout();
			}
		}).bind(this));
		
		this._template.on("logout_confirm", (function() {
			this._user.logout();
			this._template.set("showLogoutConfirmation", false);
		}).bind(this));
		
		this._template.on("logout_cancel", (function() {
			this._template.set("showLogoutConfirmation", false);
		}).bind(this));
		
		
		
		/////////user menu
		div.control_panel {
			position: absolute;
			z-index: 2;
			right: 0;
			margin-top: -2px;
			border-top: 2px solid #494949;
			padding: .5em;
			box-shadow: 0 3px 7px rgba(0, 0, 0, .3);
			background: white;
		}
		
		div.logout {
			border-top: 1px solid #bababa;
			padding-top: .2em;
		}
		
		div.logout_confirmation {
			font-size: .9em;
		}
		
		div.logout_confirmation input {
			padding: .3em .5em;
		}
		
		div.logout_confirmation_buttons {
			display: flex;
			justify-content: flex-start;
		}
		
		input.logout_confirm {
			color: #FFFFFF;
			text-shadow: 1px 1px 0 rgba(255, 255, 255, .3);
			border: 1px solid #262626;
			background: #595959;
		}
		
		input.logout_cancel {
			color: #212121;
			text-shadow: 1px 1px 0 rgba(0, 0, 0, .1);
			border: 1px solid #A0A0A0;
			background: #F7F7F7;
		}
		
		
		{{#userIsLoggedIn}}
			<div class="logout">
				{{#showLogoutConfirmation}}
					<div class="logout_confirmation">
						<div class="logout_confirmation_message">
							You must finish all games before logging out.
						</div>
						<div class="logout_confirmation_buttons">
							<input type="button" class="logout_confirm_logout" on-click="logout_confirm" value="Resign all games and log out">
							<input type="button" class="logout_confirm_cancel" on-click="logout_cancel" value="Cancel">
						</div>
					</div>
				{{/showLogoutConfirmation}}
				{{^showLogoutConfirmation}}
					<a href="javascript:void(0)" on-click="logout">Log out</a>
				{{/showLogoutConfirmation}}
			</div>
		{{/userIsLoggedIn}}